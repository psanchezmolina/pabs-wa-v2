<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob:;
    connect-src 'self';
  ">
  <title>Conexi√≥n WhatsApp - Pabs.ai</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="panel-container">
    <header class="panel-header">
      <h1>Conexi√≥n WhatsApp</h1>
      <p class="subtitle">Conecta tu n√∫mero de WhatsApp a Pabs.ai</p>
    </header>

    <!-- Estado de conexi√≥n -->
    <div id="status-section" class="status-section" style="display: none;">
      <div id="status-connected" class="status-box status-connected" style="display: none;">
        <div class="status-content">
          <h2>‚úÖ WhatsApp Conectado</h2>
          <p class="status-details">
            <strong>N√∫mero conectado:</strong> <span id="phone-number">-</span><br>
            <strong>√öltima conexi√≥n:</strong> <span id="last-connected">-</span>
          </p>
        </div>
      </div>

      <div id="status-disconnected" class="status-box status-disconnected" style="display: none;">
        <div class="status-content">
          <h2>‚ö†Ô∏è Desconectado</h2>
          <p>Elige un m√©todo para conectar tu WhatsApp:</p>
        </div>
      </div>

      <div id="status-loading" class="status-box status-loading">
        <div class="status-content">
          <h2>‚è≥ Cargando...</h2>
          <p>Verificando estado de conexi√≥n...</p>
        </div>
      </div>

      <div id="status-error" class="status-box status-error" style="display: none;">
        <div class="status-content">
          <h2>‚ùå Error</h2>
          <p id="error-message">No se pudo verificar el estado</p>
        </div>
      </div>

      <div id="status-official" class="status-box status-official" style="display: none;">
        <div class="status-content">
          <h2>‚ÑπÔ∏è API Oficial de WhatsApp</h2>
          <p id="official-message">Esta cuenta usa la API Oficial. Para gestionar la conexi√≥n, debe ir a "Configuraci√≥n ‚Üí WhatsApp" en GoHighLevel.</p>
        </div>
      </div>
    </div>

    <!-- Tabs de m√©todos de conexi√≥n -->
    <div id="connection-methods" class="connection-methods" style="display: none;">
      <div class="tabs">
        <button class="tab-button active" data-tab="qr">
          üì± QR Code (Recomendado)
        </button>
        <button class="tab-button" data-tab="pairing">
          üî¢ C√≥digo de Vinculaci√≥n
        </button>
      </div>

      <!-- Tab QR Code -->
      <div id="tab-qr" class="tab-content active">
        <div class="method-description">
          <p><strong>Escanea el c√≥digo QR con tu WhatsApp:</strong></p>
          <ol>
            <li>Abre WhatsApp en tu tel√©fono</li>
            <li>Toca <strong>Men√∫</strong> o <strong>Configuraci√≥n</strong></li>
            <li>Toca <strong>Dispositivos vinculados</strong></li>
            <li>Toca <strong>Vincular un dispositivo</strong></li>
            <li>Apunta tu tel√©fono hacia esta pantalla para escanear el c√≥digo</li>
          </ol>
        </div>

        <button id="btn-generate-qr" class="btn-primary">Generar C√≥digo QR</button>

        <div id="qr-output" class="output-container" style="display: none;">
          <div id="qr-loading" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Generando QR...</p>
          </div>
          <div id="qr-container" style="display: none;">
            <img id="qr-image" alt="QR Code" class="qr-image">
            <p class="qr-hint">El c√≥digo QR se actualiza autom√°ticamente cada 20 segundos</p>
          </div>
          <div id="qr-already-connected" class="info-message" style="display: none;">
            <p>‚úÖ Tu WhatsApp ya est√° conectado</p>
          </div>
        </div>
      </div>

      <!-- Tab Pairing Code -->
      <div id="tab-pairing" class="tab-content">
        <div class="method-description">
          <div class="warning-box">
            <strong>‚ö†Ô∏è M√©todo Experimental</strong>
            <p>El c√≥digo de vinculaci√≥n puede no funcionar si la instancia fue creada hace tiempo. Si falla, usa el m√©todo de QR Code.</p>
          </div>
          <p><strong>Vincula con c√≥digo de 8 d√≠gitos:</strong></p>
          <ol>
            <li>Ingresa tu n√∫mero de tel√©fono (sin el signo +)</li>
            <li>Genera el c√≥digo de vinculaci√≥n</li>
            <li>Abre WhatsApp en tu tel√©fono</li>
            <li>Toca <strong>Dispositivos vinculados</strong> ‚Üí <strong>Vincular un dispositivo</strong></li>
            <li>Toca <strong>Vincular con n√∫mero de tel√©fono</strong></li>
            <li>Ingresa el c√≥digo de 8 d√≠gitos</li>
          </ol>
        </div>

        <div class="input-group">
          <label for="phone-input">N√∫mero de tel√©fono:</label>
          <input
            type="text"
            id="phone-input"
            placeholder="Ej: 34660722687 (sin +)"
            pattern="[0-9]{1,15}"
            maxlength="15"
          >
          <small class="input-hint">Solo d√≠gitos, sin espacios ni el signo +</small>
        </div>

        <button id="btn-generate-pairing" class="btn-primary">Generar C√≥digo de Vinculaci√≥n</button>

        <div id="pairing-output" class="output-container" style="display: none;">
          <div id="pairing-loading" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Generando c√≥digo...</p>
          </div>
          <div id="pairing-code-display" class="pairing-code-display" style="display: none;">
            <p>Tu c√≥digo de vinculaci√≥n:</p>
            <div class="pairing-code" id="pairing-code"></div>
            <p class="pairing-hint">Ingresa este c√≥digo en WhatsApp</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Polling status -->
    <div id="polling-status" class="polling-status" style="display: none;">
      <div class="spinner-small"></div>
      <span>Esperando conexi√≥n...</span>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
